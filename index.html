<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Synthwave Aesthetic</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}
			#info {
				color: #fff;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display:block;
			}
			#info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }
		</style>
	</head>

	<body>
		<div id="info">
		<a href="https://ubernaut.github.io/spaceSim/" target="_blank" rel="noopener">spaceSim</a>
		</div>

		<script src="js/three.js"></script>

		<script src="js/loaders/DDSLoader.js"></script>
		<script src="js/loaders/MTLLoader.js"></script>
		<script src="js/loaders/OBJLoader.js"></script>
    <script src="js/controls/FlyControls.js"></script>
    <script src="js/oimo.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/libs/stats.min.js"></script>

		<script>
      var clock = new THREE.Clock();
			var container, stats;
			var camera, scene, renderer,controls;
			var mouseX = 0, mouseY = 0;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
      var world = null;
      var bodys = [];
      var fps = [0,0,0,0];
      var ToRad = 0.0174532925199432957;
      var type = 1;
      var infos;
			var ship;

      init();
			animate();

      function initOimoPhysics(){

          // world setting:( TimeStep, BroadPhaseType, Iterations )
          // BroadPhaseType can be
          // 1 : BruteForce
          // 2 : Sweep and prune , the default
          // 3 : dynamic bounding volume tree

          world =  world = new OIMO.World({
        timestep: 1/60,
        iterations: 8,
        broadphase: 2,
        worldscale: 1,
        random: true,
        info:false,
        gravity: [0,0,0]
    });
          //populate(1);
          //setInterval(updateOimoPhysics, 1000/60);

      }
			function bindship(){

			}
			function setControls(ship){
				controls = new THREE.FlyControls( ship );
				controls.movementSpeed = 100000;
				controls.domElement = container;
				controls.rollSpeed = Math.PI / 3;
				controls.autoForward = true;
				controls.dragToLook = true;
			}
			function init() {
				container = document.createElement( 'div' );
				document.body.appendChild( container );
				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 200000000000000000000000000000000000000000 );
				camera.position.y = 30;
				camera.position.z = 100;
				camera.lookAt(new THREE.Vector3(0,0,0));
				// scene
				scene = new THREE.Scene();
				var ambient = new THREE.AmbientLight( 0x888888 );
				scene.add( ambient );
				var directionalLight = new THREE.DirectionalLight( 0xffeedd );
				directionalLight.position.set( 0, 0, 1 ).normalize();
        var size = 100000000;
        var divisions = 1000;

				// var helper = new THREE.PolarGridHelper( 2000, 8, 20, 20,0xfffff,0xfffff );
				// scene.add( helper );

        var gridHelper = new THREE.GridHelper( size, divisions,0xfffff,0xfffff);

        scene.add( gridHelper );
				// scene.add( directionalLight );
				// model
				var onProgress = function ( xhr ) {
					if ( xhr.lengthComputable ) {
						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log( Math.round(percentComplete, 2) + '% downloaded' );
					}
				};
				var onError = function ( xhr ) { };
				THREE.Loader.Handlers.add( /\.dds$/i, new THREE.DDSLoader() );
				var mtlLoader = new THREE.MTLLoader();
				//mtlLoader.setPath( 'obj/male02/' );
        mtlLoader.setPath( 'js/' );
				mtlLoader.load( 'ship.mtl', function( materials ) {
					materials.preload();
					var objLoader = new THREE.OBJLoader();
					objLoader.setMaterials( materials );
					objLoader.setPath( 'js/' );
					objLoader.load( 'ship.obj', function ( object ) {
						object.position.x = 0;
						object.position.y = 0;
            object.scale.set(8,8,8);
            object.rotation.set(0,0,0);
						object.name="spaceShip";
						ship = object;
						ship.add(camera);
						camera.position.set( 0, 10, 30 );

						scene.add( object );
						setControls(ship);

					}, onProgress, onError );
				});
				//

        //scene.fog = new THREE.FogExp2( 0x000000, 0.00000025 );
				var pointlight = new THREE.PointLight();
        pointlight.position.set(0, 0, 0);
        pointlight.castShadow = true;
        scene.add(pointlight);



				renderer = new THREE.WebGLRenderer({ antialias: true, logarithmicDepthBuffer: true });
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
				// var geometry = new THREE.BoxGeometry(700, 700, 700, 10, 10, 10);
				// var material = new THREE.MeshBasicMaterial({color: 0xfffff, wireframe: true});
				// var cube = new THREE.Mesh(geometry, material);
				// scene.add(cube);


				//document.addEventListener( 'mousemove', onDocumentMouseMove, false );
				//
        // var radius = 500000000;
        // var i, r = radius, starsGeometry = [ new THREE.Geometry(), new THREE.Geometry() ];
        // for ( i = 0; i < 2500; i ++ ) {
        //   var vertex = new THREE.Vector3();
        //   vertex.x = Math.random() * 2 - 1;
        //   vertex.y = Math.random() * 2 - 1;
        //   vertex.z = Math.random() * 2 - 1;
        //   vertex.multiplyScalar( r );
        //   starsGeometry[ 0 ].vertices.push( vertex );
        // }
        // for ( i = 0; i < 1500; i ++ ) {
        //   var vertex = new THREE.Vector3();
        //   vertex.x = Math.random() * 2 - 1;
        //   vertex.y = Math.random() * 2 - 1;
        //   vertex.z = Math.random() * 2 - 1;
        //   vertex.multiplyScalar( r );
        //   starsGeometry[ 1 ].vertices.push( vertex );
        // }
        // var stars;
        // var starsMaterials = [
				// 	new THREE.PointsMaterial( { color: 0x555555, size: 2, sizeAttenuation: false } ),
				// 	new THREE.PointsMaterial( { color: 0x555555, size: 1, sizeAttenuation: false } ),
				// 	new THREE.PointsMaterial( { color: 0x333333, size: 2, sizeAttenuation: false } ),
				// 	new THREE.PointsMaterial( { color: 0x3a3a3a, size: 1, sizeAttenuation: false } ),
				// 	new THREE.PointsMaterial( { color: 0x1a1a1a, size: 2, sizeAttenuation: false } ),
				// 	new THREE.PointsMaterial( { color: 0x1a1a1a, size: 1, sizeAttenuation: false } )
				// ];
				// for ( i = 10; i < 30; i ++ ) {
				// 	stars = new THREE.Points( starsGeometry[ i % 2 ], starsMaterials[ i % 6 ] );
				// 	stars.rotation.x = Math.random() * 6;
				// 	stars.rotation.y = Math.random() * 6;
				// 	stars.rotation.z = Math.random() * 6;
				// 	stars.scale.setScalar( i * 10 );
				// 	stars.matrixAutoUpdate = false;
				// 	stars.updateMatrix();
				// 	scene.add( stars );
				// }


				var spheregeometry = new THREE.SphereGeometry(10000000000, 36, 30);
				var spherematerial = new THREE.MeshBasicMaterial({wireframe: true, color: 0xa807b7});
				var sphere = new THREE.Mesh(spheregeometry, spherematerial);

				sphere.position.set(-2.0, 0, 0);

				scene.add(sphere);
				window.addEventListener( 'resize', onWindowResize, false );
        initOimoPhysics();

			}
			function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
      function updateOimoPhysics() {
          if(world==null) return;
          world.step();
          var x, y, z, mesh, body, i = bodys.length;
          while (i--){
              body = bodys[i];
              mesh = meshs[i];
              if(!body.sleeping){
                  mesh.position.copy(body.getPosition());
                  mesh.quaternion.copy(body.getQuaternion());
                  // change material
                  if(mesh.material.name === 'sbox') mesh.material = mats.box;
                  if(mesh.material.name === 'ssph') mesh.material = mats.sph;
                  if(mesh.material.name === 'scyl') mesh.material = mats.cyl;
                  // reset position
                  if(mesh.position.y<-100){
                      x = -100 + Math.random()*200;
                      z = -100 + Math.random()*200;
                      y = 100 + Math.random()*1000;
                      body.resetPosition(x,y,z);
                  }
              } else {
                  if(mesh.material.name === 'box') mesh.material = mats.sbox;
                  if(mesh.material.name === 'sph') mesh.material = mats.ssph;
                  if(mesh.material.name === 'cyl') mesh.material = mats.scyl;
              }
          }

          //infos.innerHTML = world.getInfo();
      }

			//
			function animate() {
				requestAnimationFrame( animate );
        updateOimoPhysics();
				render();
				//camera.lookAt(ship.position);


			}
			function render() {
				var delta = clock.getDelta();
        controls.update( delta );

				renderer.render( scene, camera );
			}
		</script>

	</body>
</html>
